<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Full Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f4f7;margin:10px}
.container{max-width:1100px;margin:auto;background:#fff;padding:15px;border-radius:8px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
button,select{padding:5px;border-radius:5px}
.red{color:red;font-weight:bold}
.clickable{cursor:pointer;color:#1976d2}
</style>
</head>
<body>

<div class="container">
<h2>FULL REPORT</h2>

<h3 onclick="toggleAll()" class="clickable">All Records â¬‡</h3>
<table id="all" style="display:none"></table>
</div>

<script>
const key="dailyEntries";
let data=JSON.parse(localStorage.getItem(key)||"[]")
.map(d=>({...d,status:d.status||"",reason:d.reason||"",id:d.id||Date.now()+Math.random()}));

function save(){localStorage.setItem(key,JSON.stringify(data));}

function shortStatus(d){
 return d.status==="Other"
 ? d.reason.split(" ").slice(0,2).join(" ")
 : d.status;
}

// ---------- STATUS CHANGE ----------
function changeStatus(id,val){
 let i=data.findIndex(d=>d.id===id);
 if(i<0) return;

 if(val==="Other"){
  let r=prompt("Enter reason");
  if(!r){ render(); return; }
  data[i].status="Other";
  data[i].reason=r.trim();
 }else{
  data[i].status=val;
  data[i].reason="";
 }
 save();
 render();
}

// ---------- RENDER ----------
function render(){
 let h="<tr><th>Date</th><th>Org</th><th>Name</th><th>Amt</th><th>Action</th></tr>";

 data.forEach(d=>{
  h+=`<tr>
   <td>${d.date}</td>
   <td>${d.org}</td>
   <td>${d.name}</td>
   <td>${d.amt}</td>
   <td>

    ${d.status==="" ? `
    <button onclick="alert('Edit')">Edit</button>
    <button onclick="alert('Delete')">Delete</button>
    ` : ``}

    <br>
    <select onchange="changeStatus('${d.id}',this.value)">
     <option value="">Status</option>
     <option value="Done">Done</option>
     <option value="Pending">Pending</option>
     <option value="Other">Other</option>
    </select>

    <div class="${d.status==='Other'?'red':''}">
     ${shortStatus(d)}
    </div>

   </td>
  </tr>`;
 });

 all.innerHTML=h;
 save();
}

function toggleAll(){
 all.style.display=all.style.display==="none"?"table":"none";
}

render();
</script>

</body>
</html>
